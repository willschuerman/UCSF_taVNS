#geom_hline(yintercept=0)+
geom_point(position=position_dodge(0.5),size=3)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1,
position=position_dodge(0.5),linetype=1)+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')+
scale_color_manual(values=myPalette)
data.summary %>% filter(variable %in% c('Mean.Heart.Rate','Mean.IBI','SDNN','NN50','pNN50'))%>%
ggplot(aes(x=Block,y=Mean,shape=Participant,color=Stim))+
geom_point(position=position_dodge(0.5),size=3)+
geom_hline(yintercept=0)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1,
position=position_dodge(0.5))+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')+
scale_color_manual(values=myPalette)
# calculate mean and 95% CI for each group and variable
data.summary <- data %>%
select(Stim,Block,Participant,variable,zValue) %>% # here, change to value/cValue/zValue
group_by(Stim,Block,Participant,variable) %>%
summarise(data = list(smean.cl.boot(cur_data(), conf.int = .95, B = 1000, na.rm = TRUE))) %>%
tidyr::unnest_wider(data)
p <- data.summary %>% filter(variable %in% c('RSA','RMSSD'))%>%
ggplot(aes(x=Block,y=Mean,group=Participant,color=Stim))+
geom_point()+
geom_line()+
geom_hline(yintercept=0)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1)+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')+
theme(legend.title = element_blank(),legend.text=element_text(size=15))+
scale_color_manual(values=myPalette[c(2,1)],label=c('Concha','Sham'))
p
#ggsave("/Users/williamschuerman/Desktop/SRA Presentation Figures/concha_ind.png", width = 20, height = 10, units = "cm")
p <- data.summary %>% filter(variable %in% c('RSA','RMSSD'))%>%
ggplot(aes(x=Block,y=Mean,group=Participant,color=Stim))+
geom_point()+
geom_hline(yintercept=0)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1)+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')+
theme(legend.title = element_blank(),legend.text=element_text(size=15))+
scale_color_manual(values=myPalette)
p
p <- data.summary %>% filter(variable %in% c('RSA','RMSSD'))%>%
ggplot(aes(x=Block,y=Mean,group=Participant,color=Stim))+
geom_point()+
geom_hline(yintercept=0)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1)+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')+
theme(legend.title = element_blank(),legend.text=element_text(size=15))+
scale_color_manual(values=myPalette,name='tVNS')
p
p <- data.summary %>% filter(variable %in% c('RSA','RMSSD'))%>%
ggplot(aes(x=Block,y=Mean,group=Participant,color=Stim))+
geom_point()+
geom_hline(yintercept=0)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1)+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')+
theme(legend.text=element_text(size=15))+
scale_color_manual(values=myPalette,name='tVNS')
p
p <- data.summary %>% filter(variable %in% c('RSA','RMSSD'))%>%
ggplot(aes(x=Block,y=Mean,group=Participant,color=Stim))+
geom_point()+
geom_hline(yintercept=0)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1)+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')+
theme(legend.text=element_text(size=8))+
scale_color_manual(values=myPalette,name='tVNS')
p
p <- data.summary %>% filter(variable %in% c('RSA','RMSSD'))%>%
ggplot(aes(x=Block,y=Mean,group=Participant,color=Stim))+
geom_point()+
geom_hline(yintercept=0)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1)+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')+
scale_color_manual(values=myPalette,name='tVNS')
p
p <- data.summary %>% filter(variable %in% c('RSA','RMSSD'))%>%
ggplot(aes(x=Block,y=Mean,group=Participant,color=Stim))+
geom_point(position=position_dodge(0.5),size=3)+
geom_hline(yintercept=0)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1,position=position_dodge(0.5))+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')+
scale_color_manual(values=myPalette,name='tVNS')
p
p <- data.summary %>% filter(variable %in% c('RSA','RMSSD'))%>%
ggplot(aes(x=Block,y=Mean,group=Participant,color=Stim,shape=Participant))+
geom_point(position=position_dodge(0.5),size=3)+
geom_hline(yintercept=0)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1,position=position_dodge(0.5))+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')+
scale_color_manual(values=myPalette,name='tVNS')
p
p <- data.summary %>% filter(variable %in% c('RSA','RMSSD'))%>%
ggplot(aes(x=Block,y=Mean,color=Participant,color=Stim,shape=Participant))+
geom_point(position=position_dodge(0.5),size=3)+
geom_hline(yintercept=0)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1,position=position_dodge(0.5))+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')
p
p <- data.summary %>% filter(variable %in% c('RSA','RMSSD'))%>%
ggplot(aes(x=Block,y=Mean,color=Participant,shape=Participant))+
geom_point(position=position_dodge(0.5),size=3)+
geom_hline(yintercept=0)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1,position=position_dodge(0.5))+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')
p
p <- data.summary %>% filter(variable %in% c('RSA','RMSSD'))%>%
ggplot(aes(x=Block,y=Mean,color=Participant,shape=Participant))+
geom_line()+
geom_point(position=position_dodge(0.5),size=3)+
geom_hline(yintercept=0)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1,position=position_dodge(0.5))+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')
p <- data.summary %>% filter(variable %in% c('RSA','RMSSD'))%>%
ggplot(aes(x=Block,y=Mean,color=Participant,shape=Participant))+
geom_line(position=position_dodge(0.5))+
geom_point(position=position_dodge(0.5),size=3)+
geom_hline(yintercept=0)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1,position=position_dodge(0.5))+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')
p
p <- data.summary %>% filter(variable %in% c('RSA','RMSSD'))%>%
ggplot(aes(x=Block,y=Mean,color=Participant,shape=Participant,group=Participant))+
geom_line(position=position_dodge(0.5))+
geom_point(position=position_dodge(0.5),size=3)+
geom_hline(yintercept=0)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1,position=position_dodge(0.5))+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')
p
data.summary %>% ggplot(aes(x=Block,y=Mean,group=Participant,color=Stim))+
geom_point()+
geom_line()+
geom_hline(yintercept=0)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1)+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')+
scale_color_manual(values=myPalette)
data.summary %>% filter(variable %in% c('RSA','RMSSD','SDNN'))%>%
ggplot(aes(x=Block,y=Mean,shape=Participant,color=Stim))+
#geom_hline(yintercept=0)+
geom_point(position=position_dodge(0.5),size=3)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1,
position=position_dodge(0.5),linetype=1)+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')+
scale_color_manual(values=myPalette)
data.summary %>% filter(variable %in% c('RSA','RMSSD','SDNN'))%>%
ggplot(aes(x=Block,y=Mean,color=Participant))+
#geom_hline(yintercept=0)+
geom_point(position=position_dodge(0.5),size=3)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1,
position=position_dodge(0.5),linetype=1)+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')
data.summary %>% filter(variable %in% c('RSA','RMSSD','SDNN'))%>%
ggplot(aes(x=Block,y=Mean,color=Participant))+
geom_line(position=position_dodge(0.5))+
#geom_hline(yintercept=0)+
geom_point(position=position_dodge(0.5),size=3)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1,
position=position_dodge(0.5),linetype=1)+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')
data.summary %>% filter(variable %in% c('RSA','RMSSD','SDNN'))%>%
ggplot(aes(x=Block,y=Mean,color=Participant,group=Participant))+
geom_hline(yintercept=0)+
geom_line(position=position_dodge(0.5))+
geom_point(position=position_dodge(0.5),size=3)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1,
position=position_dodge(0.5),linetype=1)+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')
data.summary %>% filter(variable %in% c('RSA','RMSSD'))%>%
ggplot(aes(x=Block,y=Mean,color=Participant,group=Participant,shape=Participant))+
geom_hline(yintercept=0)+
geom_line(position=position_dodge(0.5))+
geom_point(position=position_dodge(0.5),size=3)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1,
position=position_dodge(0.5),linetype=1)+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')
library(readxl)
library(stringr)
library(hablar)
library(reshape)
library(Hmisc)
library(tidyverse)
# define custom color palette
myPalette <- c("#8961b3","#b55960","#999c47")
data_dir <- getwd()
data_dir <- sub('/Code/R','/Data/SART_Microstudy/Physiology/',data_dir)
file_names <- list.files(path=data_dir,pattern='*.xlsx')
# prepare data
make_table <- 1
for(f in file_names){
tmp <- read_excel(str_c(data_dir,'/',f),sheet='HRV Stats',n_max=25)
tmp <- as_tibble(t(tmp),name_repair=T)
names(tmp) <- as.character(as.vector(tmp[1,]))
tmp <- tmp[-1,]
tmp$Minute <- as.numeric(row.names(tmp))
tmp <- tmp %>% retype()
tmp$Participant <- substr(f,5,7)
if(make_table==1){
data <- tmp
make_table=0
}else{
data <- rbind(data,tmp)
}
}
# Add blocks labels
data$Block <- 'Baseline'
data$Block[data$Minute > 5 & data$Minute<=10] <- 'SART 1'
data$Block[data$Minute > 10 & data$Minute<=15] <- 'SART 2'
data$Block[data$Minute > 15 & data$Minute<=20] <- 'Recovery 1'
data$Block[data$Minute > 20 & data$Minute<=25] <- 'SART 3'
data$Block[data$Minute > 25 & data$Minute<=30] <- 'SART 4'
data$Block[data$Minute > 30 & data$Minute<=35] <- 'Recovery 2'
data$Block <- factor(data$Block,levels = c('Baseline','SART 1','SART 2',
'Recovery 1','SART 3','SART 4',
'Recovery 2'))
data$Stim <- FALSE
data$Stim[as.numeric(data$Participant) %% 2 ==0 &
data$Block %in% c('SART 1','SART 2')] <- TRUE
data$Stim[as.numeric(data$Participant) %% 2 ==1 &
data$Block %in% c('SART 3','SART 4')] <- TRUE
data <- data[,c("Participant","Block","Stim","Minute","Mean Heart Rate",
"RSA","Mean IBI","SDNN","RMSSD",'AVNN','NN50','pNN50')]
data <- data[order(data$Minute),]
# log transform specific variables
data$SDNN <- log(data$SDNN)
data$RMSSD <- log(data$RMSSD)
# melt data
data <- melt(data.frame(data),id=c('Participant','Block','Stim','Minute'))
# center to baseline
for(p in unique(data$Participant)){
for(v in unique(data$variable)){
base_mean = mean(data[data$Participant==p & data$variable==v & data$Block=='Baseline','value'],na.rm=T)
base_std = sd(data[data$Participant==p & data$variable==v & data$Block=='Baseline','value'],na.rm=T)
data[data$Participant==p & data$variable==v,'cValue'] <- (data[data$Participant==p & data$variable==v,'value'] - base_mean)
data[data$Participant==p & data$variable==v,'zValue'] <- (data[data$Participant==p & data$variable==v,'value'] - base_mean)/base_std
}
}
data %>% ggplot(aes(x=zValue))+
geom_histogram()+
facet_grid(Participant~variable,scales='free')+
theme_bw()
# plot mean for each individual
data.summary <- data %>% group_by(Participant,Block,Stim,variable) %>% summarise(value=mean(zValue,na.rm=T))
data.summary %>%
ggplot(aes(x=Block,y=value,color=Stim,group=Participant))+
geom_point()+
geom_line()+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z)')+
scale_color_manual(values=myPalette)
# calculate mean and standard deviation at group level
# data.summary <- data %>% group_by(Block,variable) %>% summarise(mean=mean(value,na.rm=T),std=sd(value,na.rm=T),n=n()) %>%
#   mutate(se=std/sqrt(n))
# calculate mean and 95% CI for each variable
data.summary <- data %>%
select(Block,variable,zValue) %>%
group_by(Block,variable) %>%
summarise(data = list(smean.cl.boot(cur_data(), conf.int = .95, B = 1000, na.rm = TRUE))) %>%
tidyr::unnest_wider(data)
data.summary %>% ggplot(aes(x=Block,y=Mean,group=''))+
geom_point()+
geom_line()+
geom_hline(yintercept=0)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1)+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
# calculate mean and 95% CI for each group and variable
data.summary <- data %>%
select(Stim,Participant,Block,variable,value) %>% # here, change to value/cValue/zValue
group_by(Stim,Participant,Block,variable) %>%
summarise(data = list(smean.cl.boot(cur_data(), conf.int = .95, B = 1000, na.rm = TRUE))) %>%
tidyr::unnest_wider(data)
data.summary %>% ggplot(aes(x=Block,y=Mean,group=Participant,color=Stim))+
geom_point()+
geom_line()+
geom_hline(yintercept=0)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1)+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')+
scale_color_manual(values=myPalette)
data.summary %>% filter(variable %in% c('RSA','RMSSD','SDNN'))%>%
ggplot(aes(x=Block,y=Mean,shape=Participant,color=Stim))+
#geom_hline(yintercept=0)+
geom_point(position=position_dodge(0.5),size=3)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1,
position=position_dodge(0.5),linetype=1)+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')+
scale_color_manual(values=myPalette)
data.summary %>% filter(variable %in% c('Mean.Heart.Rate','Mean.IBI','SDNN','NN50','pNN50'))%>%
ggplot(aes(x=Block,y=Mean,shape=Participant,color=Stim))+
geom_point(position=position_dodge(0.5),size=3)+
geom_hline(yintercept=0)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1,
position=position_dodge(0.5))+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')+
scale_color_manual(values=myPalette)
# calculate mean and 95% CI for each group and variable
data.summary <- data %>%
select(Stim,Block,Participant,variable,zValue) %>% # here, change to value/cValue/zValue
group_by(Stim,Block,Participant,variable) %>%
summarise(data = list(smean.cl.boot(cur_data(), conf.int = .95, B = 1000, na.rm = TRUE))) %>%
tidyr::unnest_wider(data)
data.summary %>% filter(variable %in% c('RSA','RMSSD'))%>%
ggplot(aes(x=Block,y=Mean,color=Participant,group=Participant,shape=Participant))+
geom_hline(yintercept=0)+
geom_line(position=position_dodge(0.5))+
geom_point(position=position_dodge(0.5),size=3)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1,
position=position_dodge(0.5),linetype=1)+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')
p <- data.summary %>% filter(variable %in% c('RSA','RMSSD'))%>%
ggplot(aes(x=Block,y=Mean,color=Participant,shape=Participant,group=Participant))+
geom_line(position=position_dodge(0.5))+
geom_point(position=position_dodge(0.5),size=3)+
geom_hline(yintercept=0)+
geom_errorbar(aes(ymin=Lower,ymax=Upper),width=0.1,position=position_dodge(0.5))+
facet_wrap('variable',scales='free_y')+
ggpubr::theme_pubclean()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ylab('Mean (z) ±95% CI')
#scale_color_manual(values=myPalette,name='tVNS')
p
#ggsave("/Users/williamschuerman/Desktop/SRA Presentation Figures/concha_ind.png", width = 20, height = 10, units = "cm")
library(hablar)
library(stringr)
library(Rmisc)
library(zoo)
library(tidyverse)
myPalette <- c("#8961b3","#b55960","#999c47")
# define custom functions
adjust_idx <- function(idx,btrial){
# check that idx isn't greater than limits of vector
idx_start = idx-4
if(idx_start<1){
idx_start = 1
}
idx_stop = idx+4
if(idx_stop>length(btrial)){
idx_stop=length(btrial)
}
# # check that idx doesn't cross block boundaries (changed to looping over blocks)
# while(btrial[idx_start]>btrial[idx]){
#   idx_start=idx_start+1
# }
# while(btrial[idx_stop]<btrial[idx]){
#   idx_stop=idx_stop-1
# }
return(c(idx_start,idx_stop))
}
get_event_matrix <- function(idx_vector,data_vector,btrial){
event_matrix = matrix(data=NA,nrow=length(idx_vector),ncol=9)
counter <- 1
for(idx in idx_vector){
idx_start_stop <- adjust_idx(idx,btrial)
midx_start <- 5-(idx-idx_start_stop[1])
midx_stop <- 5+(idx_start_stop[2]-idx)
event_matrix[counter,seq(midx_start,midx_stop)] <- data_vector[seq(idx_start_stop[1],idx_start_stop[2])]
counter <- counter+1
}
return(event_matrix)
}
make_event_df <- function(idx,RT,btrial,matrix_names,event_type){
if(!is_empty(idx)){
RT = get_event_matrix(idx,RT,btrial)
event_df <- data.frame(RT)
names(event_df) <- matrix_names
event_df <- reshape2::melt(event_df)
event_df$type <- event_type
}else{
event_df <- data.frame(matrix(ncol=3,nrow=0))
names(event_df) <- c('variable','value','type')
}
return(event_df)
}
# need to add block ids
calc_event_metrics <- function(accuracy,RT,anticipations,commissions,omissions,btrial,trialcode){
matrix_names <- c('t-4','t-3','t-2','t-1','t0','t+1','t+2','t+3','t+4')
# find ids of errors and collect RTs
idx = which(accuracy==0)
event_data <-  make_event_df(idx,RT,btrial,matrix_names,'error')
# find ids of correct trials and collect RTs
idx = which(accuracy==1)
tmp <-  make_event_df(idx,RT,btrial,matrix_names,'correct')
event_data <- rbind(event_data,tmp)
# find ids of go trials and collect RTs
idx = which(trialcode=='go')
tmp <-  make_event_df(idx,RT,btrial,matrix_names,'go')
event_data <- rbind(event_data,tmp)
# find ids of anticipations and collect RTs
idx = which(trialcode=='nogo')
tmp <-  make_event_df(idx,RT,btrial,matrix_names,'nogo')
event_data <- rbind(event_data,tmp)
# find ids of anticipations and collect RTs
idx = which(anticipations==1)
tmp <-  make_event_df(idx,RT,btrial,matrix_names,'anticipation')
event_data <- rbind(event_data,tmp)
# find ids of commissions and collect RTs
idx = which(commissions==1)
tmp <-  make_event_df(idx,RT,btrial,matrix_names,'commission')
event_data <- rbind(event_data,tmp)
# find ids of omissions and collect RTs
idx = which(omissions==1)
tmp <-  make_event_df(idx,RT,btrial,matrix_names,'omission')
event_data <- rbind(event_data,tmp)
# clean up data frame
names(event_data) <- c('time','RT','type')
event_data$time <- factor(event_data$time,levels = matrix_names)
return(event_data)
}
data_dir <- getwd()
data_dir <- sub('/Code/R','/Data/SART_Microstudy/Behavior/',data_dir)
file_names <- list.files(path=data_dir,pattern='*.csv')
#### prepare data ####
make_table=1
for(f in file_names){
tmp <- read_csv(str_c(data_dir,'/',f))
tmp <- tmp %>% retype()
tmp$stimblock = 0
if(any(tmp$blocknum>0)){
if(all(tmp$subject %% 2 == 0)){
tmp[tmp$blocknum<3,]$stimblock =1
}else{
tmp[tmp$blocknum>2,]$stimblock =1
}
}
tmp$filename <- f
if(make_table==1){
data <- tmp
make_table=0
}else{
data <- rbind(data,tmp)
}
}
# fix PID for first participant
data[data$subject==101,]$subject <- 501
# create trial number within block variable
data <- data %>% group_by(subject,blocknum) %>% mutate(btrial = row_number())
